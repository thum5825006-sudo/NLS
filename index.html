<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trợ lý Hình học Phẳng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .input-group {
            transition: all 0.3s ease;
        }
        .input-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        canvas {
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-10 animate-float">
            <div class="inline-block glass-effect rounded-2xl px-8 py-6 shadow-2xl">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-shapes text-purple-600 mr-3"></i>
                    AI Trợ lý Hình học Phẳng
                </h1>
                <p class="text-gray-600">Nhập 3 giá trị (cạnh hoặc góc) để tính toán và vẽ hình tam giác</p>
            </div>
        </header>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="glass-effect rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                    <i class="fas fa-edit text-purple-600 mr-2"></i>
                    Nhập liệu
                </h2>
                
                <div class="space-y-4">
                    <!-- Input 1 -->
                    <div class="input-group bg-white rounded-xl p-4 shadow-md">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Giá trị 1
                        </label>
                        <div class="flex gap-2">
                            <select id="type1" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="side">Cạnh</option>
                                <option value="angle">Góc</option>
                            </select>
                            <input type="number" id="value1" placeholder="Nhập giá trị" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   step="0.01">
                            <span class="flex items-center px-3 text-gray-600">
                                <span id="unit1">cm</span>
                            </span>
                        </div>
                    </div>

                    <!-- Input 2 -->
                    <div class="input-group bg-white rounded-xl p-4 shadow-md">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Giá trị 2
                        </label>
                        <div class="flex gap-2">
                            <select id="type2" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="side">Cạnh</option>
                                <option value="angle">Góc</option>
                            </select>
                            <input type="number" id="value2" placeholder="Nhập giá trị" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   step="0.01">
                            <span class="flex items-center px-3 text-gray-600">
                                <span id="unit2">cm</span>
                            </span>
                        </div>
                    </div>

                    <!-- Input 3 -->
                    <div class="input-group bg-white rounded-xl p-4 shadow-md">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Giá trị 3
                        </label>
                        <div class="flex gap-2">
                            <select id="type3" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="side">Cạnh</option>
                                <option value="angle">Góc</option>
                            </select>
                            <input type="number" id="value3" placeholder="Nhập giá trị" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   step="0.01">
                            <span class="flex items-center px-3 text-gray-600">
                                <span id="unit3">cm</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-6 flex gap-3">
                    <button onclick="calculateTriangle()" 
                            class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all duration-300 shadow-lg hover:shadow-xl">
                        <i class="fas fa-calculator mr-2"></i>
                        Tính toán & Vẽ
                    </button>
                    <button onclick="clearAll()" 
                            class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-all duration-300">
                        <i class="fas fa-redo mr-2"></i>
                        Xóa
                    </button>
                </div>

                <!-- Error Message -->
                <div id="errorMessage" class="mt-4 hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="errorText"></span>
                </div>
            </div>

            <!-- Canvas Section -->
            <div class="glass-effect rounded-2xl p-6 shadow-xl">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                    <i class="fas fa-draw-polygon text-purple-600 mr-2"></i>
                    Mô phỏng Hình học
                </h2>
                <canvas id="triangleCanvas" width="500" height="400" class="w-full bg-white"></canvas>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="mt-8 glass-effect rounded-2xl p-6 shadow-xl hidden">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">
                <i class="fas fa-chart-line text-purple-600 mr-2"></i>
                Kết quả Tính toán
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-4 shadow-md">
                    <h3 class="font-semibold text-gray-700 mb-3">Các cạnh</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Cạnh a:</span>
                            <span id="sideA" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Cạnh b:</span>
                            <span id="sideB" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Cạnh c:</span>
                            <span id="sideC" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-md">
                    <h3 class="font-semibold text-gray-700 mb-3">Các góc</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Góc A:</span>
                            <span id="angleA" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Góc B:</span>
                            <span id="angleB" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Góc C:</span>
                            <span id="angleC" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-md">
                    <h3 class="font-semibold text-gray-700 mb-3">Thông tin khác</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Chu vi:</span>
                            <span id="perimeter" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Diện tích:</span>
                            <span id="area" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Loại tam giác:</span>
                            <span id="triangleType" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update unit display based on type selection
        document.getElementById('type1').addEventListener('change', function() {
            document.getElementById('unit1').textContent = this.value === 'angle' ? '°' : 'cm';
        });
        document.getElementById('type2').addEventListener('change', function() {
            document.getElementById('unit2').textContent = this.value === 'angle' ? '°' : 'cm';
        });
        document.getElementById('type3').addEventListener('change', function() {
            document.getElementById('unit3').textContent = this.value === 'angle' ? '°' : 'cm';
        });

        function clearAll() {
            document.getElementById('value1').value = '';
            document.getElementById('value2').value = '';
            document.getElementById('value3').value = '';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            const canvas = document.getElementById('triangleCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function calculateTriangle() {
            // Get input values
            const type1 = document.getElementById('type1').value;
            const type2 = document.getElementById('type2').value;
            const type3 = document.getElementById('type3').value;
            const value1 = parseFloat(document.getElementById('value1').value);
            const value2 = parseFloat(document.getElementById('value2').value);
            const value3 = parseFloat(document.getElementById('value3').value);

            // Validate inputs
            if (isNaN(value1) || isNaN(value2) || isNaN(value3)) {
                showError('Vui lòng nhập đầy đủ 3 giá trị hợp lệ!');
                return;
            }

            // Initialize triangle data
            let triangle = {
                a: null, b: null, c: null,
                A: null, B: null, C: null
            };

            // Map input values to triangle data
            if (type1 === 'side') triangle.a = value1;
            else triangle.A = value1;
            
            if (type2 === 'side') triangle.b = value2;
            else triangle.B = value2;
            
            if (type3 === 'side') triangle.c = value3;
            else triangle.C = value3;

            // Calculate missing values
            const result = solveTriangle(triangle);
            
            if (!result.success) {
                showError(result.error);
                return;
            }

            // Hide error message
            document.getElementById('errorMessage').classList.add('hidden');

            // Display results
            displayResults(result.triangle);
            
            // Draw triangle
            drawTriangle(result.triangle);
        }

        function solveTriangle(triangle) {
            const { a, b, c, A, B, C } = triangle;
            
            try {
                // Case 1: Three sides (SSS)
                if (a && b && c) {
                    // Check triangle inequality
                    if (a + b <= c || a + c <= b || b + c <= a) {
                        return { success: false, error: 'Ba cạnh không tạo thành tam giác hợp lệ!' };
                    }
                    
                    // Use Law of Cosines
                    triangle.A = Math.acos((b*b + c*c - a*a) / (2*b*c)) * 180 / Math.PI;
                    triangle.B = Math.acos((a*a + c*c - b*b) / (2*a*c)) * 180 / Math.PI;
                    triangle.C = 180 - triangle.A - triangle.B;
                }
                // Case 2: Two sides and included angle (SAS)
                else if (a && b && C) {
                    triangle.c = Math.sqrt(a*a + b*b - 2*a*b*Math.cos(C * Math.PI / 180));
                    triangle.A = Math.acos((b*b + triangle.c*triangle.c - a*a) / (2*b*triangle.c)) * 180 / Math.PI;
                    triangle.B = 180 - triangle.A - C;
                }
                else if (a && c && B) {
                    triangle.b = Math.sqrt(a*a + c*c - 2*a*c*Math.cos(B * Math.PI / 180));
                    triangle.A = Math.acos((triangle.b*triangle.b + c*c - a*a) / (2*triangle.b*c)) * 180 / Math.PI;
                    triangle.C = 180 - triangle.A - B;
                }
                else if (b && c && A) {
                    triangle.a = Math.sqrt(b*b + c*c - 2*b*c*Math.cos(A * Math.PI / 180));
                    triangle.B = Math.acos((a*a + c*c - b*b) / (2*a*c)) * 180 / Math.PI;
                    triangle.C = 180 - A - triangle.B;
                }
                // Case 3: Two angles and one side (ASA or AAS)
                else if (A && B && a) {
                    triangle.C = 180 - A - B;
                    triangle.b = a * Math.sin(B * Math.PI / 180) / Math.sin(A * Math.PI / 180);
                    triangle.c = a * Math.sin(C * Math.PI / 180) / Math.sin(A * Math.PI / 180);
                }
                else if (A && B && b) {
                    triangle.C = 180 - A - B;
                    triangle.a = b * Math.sin(A * Math.PI / 180) / Math.sin(B * Math.PI / 180);
                    triangle.c = b * Math.sin(C * Math.PI / 180) / Math.sin(B * Math.PI / 180);
                }
                else if (A && B && c) {
                    triangle.C = 180 - A - B;
                    triangle.a = c * Math.sin(A * Math.PI / 180) / Math.sin(C * Math.PI / 180);
                    triangle.b = c * Math.sin(B * Math.PI / 180) / Math.sin(C * Math.PI / 180);
                }
                else if (A && C && a) {
                    triangle.B = 180 - A - C;
                    triangle.b = a * Math.sin(B * Math.PI / 180) / Math.sin(A * Math.PI / 180);
                    triangle.c = a * Math.sin(C * Math.PI / 180) / Math.sin(A * Math.PI / 180);
                }
                else if (B && C && b) {
                    triangle.A = 180 - B - C;
                    triangle.a = b * Math.sin(A * Math.PI / 180) / Math.sin(B * Math.PI / 180);
                    triangle.c = b * Math.sin(C * Math.PI / 180) / Math.sin(B * Math.PI / 180);
                }
                else {
                    return { success: false, error: 'Không thể giải tam giác với dữ liệu đã cho. Vui lòng kiểm tra lại!' };
                }

                return { success: true, triangle };
            } catch (error) {
                return { success: false, error: 'Lỗi trong quá trình tính toán. Vui lòng kiểm tra lại dữ liệu!' };
            }
        }

        function getTriangleType(triangle) {
            const { a, b, c, A, B, C } = triangle;
            
            // Check for right triangle
            if (Math.abs(A - 90) < 0.1 || Math.abs(B - 90) < 0.1 || Math.abs(C - 90) < 0.1) {
                return 'Tam giác vuông';
            }
            
            // Check for equilateral
            if (Math.abs(a - b) < 0.1 && Math.abs(b - c) < 0.1) {
                return 'Tam giác đều';
            }
            
            // Check for isosceles
            if (Math.abs(a - b) < 0.1 || Math.abs(b - c) < 0.1 || Math.abs(a - c) < 0.1) {
                return 'Tam giác cân';
            }
            
            // Check angles
            if (A < 90 && B < 90 && C < 90) {
                return 'Tam giác nhọn';
            }
            
            return 'Tam giác tù';
        }

        function displayResults(triangle) {
            const { a, b, c, A, B, C } = triangle;
            
            // Display sides
            document.getElementById('sideA').textContent = a ? `${a.toFixed(2)} cm` : '-';
            document.getElementById('sideB').textContent = b ? `${b.toFixed(2)} cm` : '-';
            document.getElementById('sideC').textContent = c ? `${c.toFixed(2)} cm` : '-';
            
            // Display angles
            document.getElementById('angleA').textContent = A ? `${A.toFixed(2)}°` : '-';
            document.getElementById('angleB').textContent = B ? `${B.toFixed(2)}°` : '-';
            document.getElementById('angleC').textContent = C ? `${C.toFixed(2)}°` : '-';
            
            // Calculate and display perimeter
            const perimeter = (a || 0) + (b || 0) + (c || 0);
            document.getElementById('perimeter').textContent = `${perimeter.toFixed(2)} cm`;
            
            // Calculate and display area using Heron's formula
            if (a && b && c) {
                const s = perimeter / 2;
                const area = Math.sqrt(s * (s - a) * (s - b) * (s - c));
                document.getElementById('area').textContent = `${area.toFixed(2)} cm²`;
            } else {
                document.getElementById('area').textContent = '-';
            }
            
            // Display triangle type
            document.getElementById('triangleType').textContent = getTriangleType(triangle);
            
            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');
        }

        function drawTriangle(triangle) {
            const canvas = document.getElementById('triangleCanvas');
            const ctx = canvas.getContext('2d');
            const { a, b, c, A, B, C } = triangle;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Calculate scale to fit triangle in canvas
            const maxSide = Math.max(a || 0, b || 0, c || 0);
            const scale = Math.min(350 / maxSide, 1);
            
            // Calculate vertices
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Place first vertex at center-left
            const x1 = centerX - 150;
            const y1 = centerY;
            
            // Place second vertex based on side c
            const x2 = x1 + (c * scale);
            const y2 = y1;
            
            // Calculate third vertex using law of cosines
            const angleA_rad = (A * Math.PI) / 180;
            const x3 = x1 + (b * scale) * Math.cos(angleA_rad);
            const y3 = y1 - (b * scale) * Math.sin(angleA_rad);
            
            // Draw triangle
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x3, y3);
            ctx.closePath();
            
            // Fill triangle
            ctx.fillStyle = 'rgba(147, 51, 234, 0.1)';
            ctx.fill();
            
            // Draw triangle outline
            ctx.strokeStyle = '#9333ea';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw vertices
            const vertices = [
                { x: x1, y: y1, label: 'A' },
                { x: x2, y: y2, label: 'B' },
                { x: x3, y: y3, label: 'C' }
            ];
            
            vertices.forEach(vertex => {
                ctx.beginPath();
                ctx.arc(vertex.x, vertex.y, 5, 0, 2 * Math.PI);
                ctx.fillStyle = '#9333ea';
                ctx.fill();
                
                // Draw labels
                ctx.fillStyle = '#1f2937';
                ctx.font = 'bold 16px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(vertex.label, vertex.x, vertex.y - 20);
            });
            
            // Draw side labels
            ctx.fillStyle = '#4b5563';
            ctx.font = '14px Inter';
            
            // Side a (BC)
            if (a) {
                const midX = (x2 + x3) / 2;
                const midY = (y2 + y3) / 2;
                ctx.fillText(`a = ${a.toFixed(1)}cm`, midX, midY + 20);
            }
            
            // Side b (AC)
            if (b) {
                const midX = (x1 + x3) / 2;
                const midY = (y1 + y3) / 2;
                ctx.fillText(`b = ${b.toFixed(1)}cm`, midX - 30, midY);
            }
            
            // Side c (AB)
            if (c) {
                const midX = (x1 + x2) / 2;
                const midY = (y1 + y2) / 2;
                ctx.fillText(`c = ${c.toFixed(1)}cm`, midX, midY + 20);
            }
            
            // Draw angle arcs
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 1;
            
            // Angle A
            if (A) {
                drawAngleArc(ctx, x1, y1, x2, y2, x3, y3, A);
            }
            
            // Angle B
            if (B) {
                drawAngleArc(ctx, x2, y2, x3, y3, x1, y1, B);
            }
            
            // Angle C
            if (C) {
                drawAngleArc(ctx, x3, y3, x1, y1, x2, y2, C);
            }
        }

        function drawAngleArc(ctx, vertexX, vertexY, point1X, point1Y, point2X, point2Y, angle) {
            const radius = 30;
            const angle1 = Math.atan2(point1Y - vertexY, point1X - vertexX);
            const angle2 = Math.atan2(point2Y - vertexY, point2X - vertexX);
            
            ctx.beginPath();
            ctx.arc(vertexX, vertexY, radius, angle1, angle2);
            ctx.stroke();
            
            // Draw angle label
            const midAngle = (angle1 + angle2) / 2;
            const labelX = vertexX + (radius + 15) * Math.cos(midAngle);
            const labelY = vertexY + (radius + 15) * Math.sin(midAngle);
            
            ctx.fillStyle = '#ef4444';
            ctx.font = '12px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(`${angle.toFixed(1)}°`, labelX, labelY);
        }
    </script>
</body>
</html>